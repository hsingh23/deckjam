'use strict';
"use babel";

if (location.protocol != 'http:') {
  location.protocol = 'http:';
}
// if ('serviceWorker' in navigator) {
//   navigator.serviceWorker.register('service-worker.js');
// }
// removed service workers and fetch because quizlet does not do cors http://stackoverflow.com/a/34940074 
// no-cors mode won't send authorization header https://developer.mozilla.org/en-US/docs/Web/API/Request/mode
var lo = _;
// var app = angular.module('deckjam', ['ngMaterial'])
var app = angular.module('deckjam', ['ngMaterial', 'angulartics', 'angulartics.google.analytics']).config(function ($mdThemingProvider) {
  var customBlueMap = $mdThemingProvider.extendPalette('light-blue', {
    'contrastDefaultColor': 'light',
    'contrastDarkColors': ['50'],
    '50': 'ffffff'
  });
  $mdThemingProvider.definePalette('customBlue', customBlueMap);
  $mdThemingProvider.theme('default').primaryPalette('customBlue', {
    'default': '500',
    'hue-1': '50'
  }).accentPalette('pink');
  $mdThemingProvider.theme('input', 'default').primaryPalette('grey');
}).controller('homeContainer', ["$scope", "$http", "$mdToast", function (_, $http, $mdToast) {
  _.api = 'http://ayudh.org:3337';
  // _.api = 'http://localhost:3337'
  _.createdOne = localStorage.createdOne && parseInt(localStorage.createdOne) || 0;
  _.fetching = false;
  _.getSetsforTerm = function (term) {
    return $http.get(_.api + '/quizlet/search?query=' + term, { cache: true });
  };
  _.getSets = function (sets) {
    return $http.get(_.api + '/quizlet/sets?query=' + sets, { cache: true });
  };
  _.decks = {};
  // _.decks = JSON.parse(localStorage.decks || '{}')
  _.selected = JSON.parse(localStorage.selected || '{}');
  _.selectedOrder = "time";
  _.reverse = true;
  _.md = false;
  _.numSelected = function () {
    return lo.size(_.selected);
  };
  _.numDecks = function () {
    return lo.size(_.decks);
  };
  _.selectedArray = function () {
    return lo.values(_.selected);
  };
  _.selectTerm = function (term, setId) {
    var mouseDown = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;

    term.selected = !!mouseDown ? !!!term.selected : !!term.selected;
    if (term.selected) {
      _.selected[term.id] = lo.assign({}, term);
      _.selected[term.id].setId = setId;
      _.selected[term.id].time = new Date().getTime();
    } else {
      delete _.selected[term.id];
    }
    localStorage.selected = JSON.stringify(_.selected);
  };
  _.removeDeck = function (id) {
    return delete _.decks[id];
  };
  _.selectAll = function (id) {
    if (_.decks[id]) {
      // some unselected, then select all
      if (_.decks[id].terms.find(function (x) {
        return !x.selected;
      })) {
        _.decks[id].terms.forEach(function (term) {
          term.selected = true;
          _.selected[term.id] = lo.assign({}, term);
          _.selected[term.id].setId = id;
          _.selected[term.id].time = new Date().getTime();
        });
      } else {
        // unselect everything
        _.decks[id].terms.forEach(function (term) {
          term.selected = false;
          delete _.selected[term.id];
        });
      }
      localStorage.selected = JSON.stringify(_.selected);
    }
  };
  _.clearSelected = function () {
    _.selected = {};
    localStorage.selected = '{}';
  };
  _.swapSelected = function (id) {
    var _$selected$id = _.selected[id],
        term = _$selected$id.term,
        definition = _$selected$id.definition;

    _.selected[id].definition = term;
    _.selected[id].term = definition;
    localStorage.selected = JSON.stringify(_.selected);
  };
  _.removeSelected = function (id) {
    var _$selected$id2 = _.selected[id],
        setId = _$selected$id2.setId,
        rank = _$selected$id2.rank;

    if (_.decks[setId]) {
      _.decks[setId].terms[rank].selected = false;
    }
    delete _.selected[id];
    localStorage.selected = JSON.stringify(_.selected);
  };
  _.create = function (title) {
    _.url = null;
    _.creating = true;
    $http({
      method: 'POST',
      url: _.api + '/create-set',
      data: JSON.stringify({
        title: title,
        lang_terms: 'en',
        lang_definitions: 'en',
        data: lo.map(_.selected, function (v, k) {
          return lo.pick(v, ['term', 'definition', 'image']);
        })
      })
    }).then(function (res) {
      _.url = 'https://quizlet.com' + res.data.url;
      _.creating = false;
      if (res.data.error) {
        $mdToast.showSimple(res.data.error);
      } else {
        $mdToast.showSimple("Your deck is created");
        _.createdOne += 1;
        localStorage.createdOne = _.createdOne;
      }
    }).catch(function () {
      _.creating = false;
      $mdToast.showSimple("Unable to create deck");
    });
  };
  _.import = function (importUrl) {
    _.fetching = true;
    var x = importUrl && importUrl.match(/\d+/);
    x && x[0] && _.getSets(x[0]).then(function (res) {
      _.fetching = false;
      res.data.forEach(function (set) {
        set.terms.forEach(function (term) {
          term.selected = true;
          _.selected[term.id] = lo.assign({}, term);
          _.selected[term.id].setId = set.id;
          _.selected[term.id].time = new Date().getTime();
        });
      });
    }).catch(function () {
      _.fetching = false;
    });
    localStorage.selected = JSON.stringify(_.selected);
  };
  _.getTerms = function (replace) {
    _.fetching = true;
    _.decks = !!replace ? {} : _.decks || {};
    _.bloom = !!replace ? new BloomFilter(3e5, 3e-5) : _.bloom || new BloomFilter(3e5, 3e-5);
    _.search.split(',').forEach(function (term) {
      _.getSetsforTerm(term.trim()).then(function (data) {
        _.getSets(data.data.sets.map(function (a) {
          return a.id;
        }).join(',')).then(function (res) {
          res.data.forEach(function (set) {
            var terms = lo.filter(set.terms, function (card) {
              if (_.bloom.test(card.term + card.definition)) {
                return false;
              } else {
                _.bloom.add(card.term + card.definition);
                return true;
              }
            });
            terms.forEach(function (t, i) {
              return t.rank = i;
            });
            if (terms.length > 2) {
              _.decks[set.id] = lo.pick(set, ['url', 'title', 'modified_date', 'lang_terms', 'lang_definitions']);
              _.decks[set.id].terms = terms;
              _.decks[set.id].terms_length = terms.length;
            }
          });
          _.fetching = false;
          _.selectedIndex = 0;
          // localStorage.decks = JSON.stringify(_.decks)
        }).catch(function () {
          _.fetching = false;
        });
      }).catch(function () {
        _.fetching = false;
      });
    });
  };
}]);

//# sourceMappingURL=data:application/json;base64,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QUFFLFFBQUYsR0FBYSxLQUFiO0FBQW1CLFNBckJuQztBQXNCQyxPQXZCSCxFQXVCSyxLQXZCTCxDQXVCVyxZQUFJO0FBQUMsVUFBRSxRQUFGLEdBQWEsS0FBYjtBQUFtQixPQXZCbkM7QUF3QkMsS0F6Qkg7QUEwQkMsR0E5Qkg7QUErQkQsQ0E1STRCLENBakJuQixDQUFWIiwiZmlsZSI6ImFwcC5wcm9kLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2UgYmFiZWxcIjtcbmlmIChsb2NhdGlvbi5wcm90b2NvbCAhPSAnaHR0cDonKSB7XG4gIGxvY2F0aW9uLnByb3RvY29sID0gJ2h0dHA6Jztcbn1cbi8vIGlmICgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSB7XG4vLyAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCdzZXJ2aWNlLXdvcmtlci5qcycpO1xuLy8gfVxuLy8gcmVtb3ZlZCBzZXJ2aWNlIHdvcmtlcnMgYW5kIGZldGNoIGJlY2F1c2UgcXVpemxldCBkb2VzIG5vdCBkbyBjb3JzIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzM0OTQwMDc0IFxuLy8gbm8tY29ycyBtb2RlIHdvbid0IHNlbmQgYXV0aG9yaXphdGlvbiBoZWFkZXIgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1JlcXVlc3QvbW9kZVxudmFyIGxvID0gXztcbi8vIHZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnZGVja2phbScsIFsnbmdNYXRlcmlhbCddKVxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdkZWNramFtJywgWyduZ01hdGVyaWFsJywgJ2FuZ3VsYXJ0aWNzJywgJ2FuZ3VsYXJ0aWNzLmdvb2dsZS5hbmFseXRpY3MnXSlcbi5jb25maWcoZnVuY3Rpb24oJG1kVGhlbWluZ1Byb3ZpZGVyKSB7XG4gIHZhciBjdXN0b21CbHVlTWFwID0gJG1kVGhlbWluZ1Byb3ZpZGVyLmV4dGVuZFBhbGV0dGUoJ2xpZ2h0LWJsdWUnLCB7XG4gICAgJ2NvbnRyYXN0RGVmYXVsdENvbG9yJzogJ2xpZ2h0JyxcbiAgICAnY29udHJhc3REYXJrQ29sb3JzJzogWyc1MCddLFxuICAgICc1MCc6ICdmZmZmZmYnXG4gIH0pXG4gICRtZFRoZW1pbmdQcm92aWRlci5kZWZpbmVQYWxldHRlKCdjdXN0b21CbHVlJywgY3VzdG9tQmx1ZU1hcClcbiAgJG1kVGhlbWluZ1Byb3ZpZGVyLnRoZW1lKCdkZWZhdWx0JylcbiAgICAucHJpbWFyeVBhbGV0dGUoJ2N1c3RvbUJsdWUnLCB7XG4gICAgICAnZGVmYXVsdCc6ICc1MDAnLFxuICAgICAgJ2h1ZS0xJzogJzUwJ1xuICAgIH0pXG4gICAgLmFjY2VudFBhbGV0dGUoJ3BpbmsnKVxuICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2lucHV0JywgJ2RlZmF1bHQnKVxuICAgIC5wcmltYXJ5UGFsZXR0ZSgnZ3JleScpXG59KVxuLmNvbnRyb2xsZXIoJ2hvbWVDb250YWluZXInLCBbXCIkc2NvcGVcIiwgXCIkaHR0cFwiLCBcIiRtZFRvYXN0XCIgLChfLCAkaHR0cCwgJG1kVG9hc3QpPT4ge1xuICBfLmFwaSA9ICdodHRwOi8vYXl1ZGgub3JnOjMzMzcnXG4gIC8vIF8uYXBpID0gJ2h0dHA6Ly9sb2NhbGhvc3Q6MzMzNydcbiAgXy5jcmVhdGVkT25lID0gbG9jYWxTdG9yYWdlLmNyZWF0ZWRPbmUgJiYgcGFyc2VJbnQobG9jYWxTdG9yYWdlLmNyZWF0ZWRPbmUpIHx8IDBcbiAgXy5mZXRjaGluZyA9IGZhbHNlXG4gIF8uZ2V0U2V0c2ZvclRlcm0gPSAodGVybSk9PiAkaHR0cC5nZXQoYCR7Xy5hcGl9L3F1aXpsZXQvc2VhcmNoP3F1ZXJ5PSR7dGVybX1gLCB7IGNhY2hlOiB0cnVlfSlcbiAgXy5nZXRTZXRzID0gKHNldHMpPT4gJGh0dHAuZ2V0KGAke18uYXBpfS9xdWl6bGV0L3NldHM/cXVlcnk9JHtzZXRzfWAsIHsgY2FjaGU6IHRydWV9KVxuICBfLmRlY2tzID0ge31cbiAgLy8gXy5kZWNrcyA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmRlY2tzIHx8ICd7fScpXG4gIF8uc2VsZWN0ZWQgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5zZWxlY3RlZCB8fCAne30nKVxuICBfLnNlbGVjdGVkT3JkZXIgPSBcInRpbWVcIlxuICBfLnJldmVyc2UgPSB0cnVlXG4gIF8ubWQgPSBmYWxzZVxuICBfLm51bVNlbGVjdGVkID0gKCk9PiBsby5zaXplKF8uc2VsZWN0ZWQpXG4gIF8ubnVtRGVja3MgPSAoKT0+IGxvLnNpemUoXy5kZWNrcylcbiAgXy5zZWxlY3RlZEFycmF5ID0gKCk9PiBsby52YWx1ZXMoXy5zZWxlY3RlZClcbiAgXy5zZWxlY3RUZXJtID0gKHRlcm0sIHNldElkLCBtb3VzZURvd249dHJ1ZSkgPT4ge1xuICAgIHRlcm0uc2VsZWN0ZWQgPSAoISFtb3VzZURvd24pID8gISEhdGVybS5zZWxlY3RlZCA6ICEhdGVybS5zZWxlY3RlZFxuICAgIGlmICh0ZXJtLnNlbGVjdGVkKSB7XG4gICAgICBfLnNlbGVjdGVkW3Rlcm0uaWRdID0gbG8uYXNzaWduKHt9LHRlcm0pXG4gICAgICBfLnNlbGVjdGVkW3Rlcm0uaWRdLnNldElkID0gc2V0SWRcbiAgICAgIF8uc2VsZWN0ZWRbdGVybS5pZF0udGltZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKClcbiAgICB9IGVsc2Uge1xuICAgICAgZGVsZXRlIF8uc2VsZWN0ZWRbdGVybS5pZF1cbiAgICB9XG4gICAgbG9jYWxTdG9yYWdlLnNlbGVjdGVkID0gSlNPTi5zdHJpbmdpZnkoXy5zZWxlY3RlZClcbiAgfVxuICBfLnJlbW92ZURlY2sgPSBpZD0+IGRlbGV0ZSBfLmRlY2tzW2lkXVxuICBfLnNlbGVjdEFsbCA9IGlkPT4ge1xuICAgIGlmIChfLmRlY2tzW2lkXSkge1xuICAgICAgLy8gc29tZSB1bnNlbGVjdGVkLCB0aGVuIHNlbGVjdCBhbGxcbiAgICAgIGlmIChfLmRlY2tzW2lkXS50ZXJtcy5maW5kKHg9PiAheC5zZWxlY3RlZCkpe1xuICAgICAgICBfLmRlY2tzW2lkXS50ZXJtcy5mb3JFYWNoKHRlcm0gPT4ge1xuICAgICAgICAgIHRlcm0uc2VsZWN0ZWQgPSB0cnVlXG4gICAgICAgICAgXy5zZWxlY3RlZFt0ZXJtLmlkXSA9IGxvLmFzc2lnbih7fSx0ZXJtKVxuICAgICAgICAgIF8uc2VsZWN0ZWRbdGVybS5pZF0uc2V0SWQgPSBpZFxuICAgICAgICAgIF8uc2VsZWN0ZWRbdGVybS5pZF0udGltZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKClcbiAgICAgICAgfSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHVuc2VsZWN0IGV2ZXJ5dGhpbmdcbiAgICAgICAgXy5kZWNrc1tpZF0udGVybXMuZm9yRWFjaCh0ZXJtID0+IHtcbiAgICAgICAgICB0ZXJtLnNlbGVjdGVkID0gZmFsc2VcbiAgICAgICAgICBkZWxldGUgXy5zZWxlY3RlZFt0ZXJtLmlkXVxuICAgICAgICB9KVxuICAgICAgfVxuICAgICAgbG9jYWxTdG9yYWdlLnNlbGVjdGVkID0gSlNPTi5zdHJpbmdpZnkoXy5zZWxlY3RlZClcbiAgICB9XG4gIH1cbiAgXy5jbGVhclNlbGVjdGVkID0gKCk9PiB7XG4gICAgXy5zZWxlY3RlZCA9IHt9XG4gICAgbG9jYWxTdG9yYWdlLnNlbGVjdGVkID0gJ3t9J1xuICB9XG4gIF8uc3dhcFNlbGVjdGVkID0gaWQ9PiB7XG4gICAgdmFyIHt0ZXJtLCBkZWZpbml0aW9ufSA9IF8uc2VsZWN0ZWRbaWRdXG4gICAgXy5zZWxlY3RlZFtpZF0uZGVmaW5pdGlvbiA9IHRlcm1cbiAgICBfLnNlbGVjdGVkW2lkXS50ZXJtID0gZGVmaW5pdGlvblxuICAgIGxvY2FsU3RvcmFnZS5zZWxlY3RlZCA9IEpTT04uc3RyaW5naWZ5KF8uc2VsZWN0ZWQpXG4gIH1cbiAgXy5yZW1vdmVTZWxlY3RlZCA9IGlkPT4ge1xuICAgIHZhciB7c2V0SWQsIHJhbmt9ID0gXy5zZWxlY3RlZFtpZF1cbiAgICBpZihfLmRlY2tzW3NldElkXSkge1xuICAgICAgXy5kZWNrc1tzZXRJZF0udGVybXNbcmFua10uc2VsZWN0ZWQgPSBmYWxzZVxuICAgIH1cbiAgICBkZWxldGUgXy5zZWxlY3RlZFtpZF1cbiAgICBsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWQgPSBKU09OLnN0cmluZ2lmeShfLnNlbGVjdGVkKVxuICB9XG4gIF8uY3JlYXRlID0gKHRpdGxlKT0+IHtcbiAgICBfLnVybCA9IG51bGxcbiAgICBfLmNyZWF0aW5nID0gdHJ1ZVxuICAgICRodHRwKHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgdXJsOiBgJHtfLmFwaX0vY3JlYXRlLXNldGAsXG4gICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHRpdGxlOiB0aXRsZSxcbiAgICAgICAgbGFuZ190ZXJtczogJ2VuJyxcbiAgICAgICAgbGFuZ19kZWZpbml0aW9uczogJ2VuJyxcbiAgICAgICAgZGF0YTogbG8ubWFwKF8uc2VsZWN0ZWQsICh2LGspPT4gbG8ucGljayh2LCBbJ3Rlcm0nLCAnZGVmaW5pdGlvbicsICdpbWFnZSddKSlcbiAgICAgIH0pXG4gICAgfSkudGhlbihyZXM9PntcbiAgICAgIF8udXJsID0gYGh0dHBzOi8vcXVpemxldC5jb20ke3Jlcy5kYXRhLnVybH1gXG4gICAgICBfLmNyZWF0aW5nID0gZmFsc2VcbiAgICAgIGlmIChyZXMuZGF0YS5lcnJvcikge1xuICAgICAgICAkbWRUb2FzdC5zaG93U2ltcGxlKHJlcy5kYXRhLmVycm9yKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJG1kVG9hc3Quc2hvd1NpbXBsZShcIllvdXIgZGVjayBpcyBjcmVhdGVkXCIpXG4gICAgICAgIF8uY3JlYXRlZE9uZSArPSAxXG4gICAgICAgIGxvY2FsU3RvcmFnZS5jcmVhdGVkT25lID0gXy5jcmVhdGVkT25lXG4gICAgICB9XG4gICAgfSkuY2F0Y2goKCk9PntcbiAgICAgIF8uY3JlYXRpbmc9ZmFsc2VcbiAgICAgICRtZFRvYXN0LnNob3dTaW1wbGUoXCJVbmFibGUgdG8gY3JlYXRlIGRlY2tcIilcbiAgICB9KVxuICB9XG4gIF8uaW1wb3J0ID0gKGltcG9ydFVybCkgPT4ge1xuICAgIF8uZmV0Y2hpbmcgPSB0cnVlXG4gICAgdmFyIHggPSBpbXBvcnRVcmwgJiYgaW1wb3J0VXJsLm1hdGNoKC9cXGQrLylcbiAgICB4ICYmIHhbMF0gJiYgXy5nZXRTZXRzKHhbMF0pLnRoZW4ocmVzPT57XG4gICAgICBfLmZldGNoaW5nID0gZmFsc2VcbiAgICAgIHJlcy5kYXRhLmZvckVhY2goc2V0PT4ge1xuICAgICAgICBzZXQudGVybXMuZm9yRWFjaCh0ZXJtID0+IHtcbiAgICAgICAgICB0ZXJtLnNlbGVjdGVkID0gdHJ1ZVxuICAgICAgICAgIF8uc2VsZWN0ZWRbdGVybS5pZF0gPSBsby5hc3NpZ24oe30sdGVybSlcbiAgICAgICAgICBfLnNlbGVjdGVkW3Rlcm0uaWRdLnNldElkID0gc2V0LmlkXG4gICAgICAgICAgXy5zZWxlY3RlZFt0ZXJtLmlkXS50aW1lID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9KS5jYXRjaCgoKT0+e18uZmV0Y2hpbmcgPSBmYWxzZX0pXG4gICAgbG9jYWxTdG9yYWdlLnNlbGVjdGVkID0gSlNPTi5zdHJpbmdpZnkoXy5zZWxlY3RlZClcbiAgfVxuICBfLmdldFRlcm1zID0gKHJlcGxhY2UpPT4ge1xuICAgIF8uZmV0Y2hpbmcgPSB0cnVlXG4gICAgXy5kZWNrcyA9ICEhcmVwbGFjZSA/IHt9IDogKF8uZGVja3MgfHwge30pXG4gICAgXy5ibG9vbSA9ICEhcmVwbGFjZSA/IG5ldyBCbG9vbUZpbHRlcigzZTUsIDNlLTUpIDogKF8uYmxvb20gfHwgbmV3IEJsb29tRmlsdGVyKDNlNSwgM2UtNSkpXG4gICAgXy5zZWFyY2guc3BsaXQoJywnKS5mb3JFYWNoKHRlcm09PiB7XG4gICAgICBfLmdldFNldHNmb3JUZXJtKHRlcm0udHJpbSgpKS50aGVuKGRhdGE9PiB7XG4gICAgICAgIF8uZ2V0U2V0cyhkYXRhLmRhdGEuc2V0cy5tYXAoYT0+YS5pZCkuam9pbignLCcpKVxuICAgICAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICByZXMuZGF0YS5mb3JFYWNoKHNldD0+IHtcbiAgICAgICAgICAgICAgdmFyIHRlcm1zID0gbG8uZmlsdGVyKHNldC50ZXJtcywgY2FyZD0+IHtcbiAgICAgICAgICAgICAgICBpZiAoXy5ibG9vbS50ZXN0KGNhcmQudGVybSArIGNhcmQuZGVmaW5pdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBfLmJsb29tLmFkZChjYXJkLnRlcm0gKyBjYXJkLmRlZmluaXRpb24pXG4gICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgdGVybXMuZm9yRWFjaCgodCxpKSA9PiB0LnJhbmsgPSBpKVxuICAgICAgICAgICAgICBpZiAodGVybXMubGVuZ3RoID4gMil7XG4gICAgICAgICAgICAgICAgXy5kZWNrc1tzZXQuaWRdID0gbG8ucGljayhzZXQsIFsndXJsJywgJ3RpdGxlJywgJ21vZGlmaWVkX2RhdGUnLCAnbGFuZ190ZXJtcycsICdsYW5nX2RlZmluaXRpb25zJ10pXG4gICAgICAgICAgICAgICAgXy5kZWNrc1tzZXQuaWRdLnRlcm1zID0gdGVybXNcbiAgICAgICAgICAgICAgICBfLmRlY2tzW3NldC5pZF0udGVybXNfbGVuZ3RoID0gdGVybXMubGVuZ3RoXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBfLmZldGNoaW5nID0gZmFsc2VcbiAgICAgICAgICAgIF8uc2VsZWN0ZWRJbmRleD0wXG4gICAgICAgICAgICAvLyBsb2NhbFN0b3JhZ2UuZGVja3MgPSBKU09OLnN0cmluZ2lmeShfLmRlY2tzKVxuICAgICAgICAgIH0pLmNhdGNoKCgpPT57Xy5mZXRjaGluZyA9IGZhbHNlfSlcbiAgICAgICAgfSkuY2F0Y2goKCk9PntfLmZldGNoaW5nID0gZmFsc2V9KVxuICAgICAgfSlcbiAgICB9XG59XSlcbiJdfQ==
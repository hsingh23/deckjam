'use strict';
"use babel";

if (location.protocol != 'http:') {
  location.protocol = 'http:';
}
// if ('serviceWorker' in navigator) {
//   navigator.serviceWorker.register('service-worker.js');
// }
// removed service workers and fetch because quizlet does not do cors http://stackoverflow.com/a/34940074 
// no-cors mode won't send authorization header https://developer.mozilla.org/en-US/docs/Web/API/Request/mode
var lo = _;
var app = angular.module('deckjam', ['ngMaterial', 'angulartics', 'angulartics.google.analytics']).config(function ($mdThemingProvider) {
  var customBlueMap = $mdThemingProvider.extendPalette('light-blue', {
    'contrastDefaultColor': 'light',
    'contrastDarkColors': ['50'],
    '50': 'ffffff'
  });
  $mdThemingProvider.definePalette('customBlue', customBlueMap);
  $mdThemingProvider.theme('default').primaryPalette('customBlue', {
    'default': '500',
    'hue-1': '50'
  }).accentPalette('pink');
  $mdThemingProvider.theme('input', 'default').primaryPalette('grey');
}).controller('homeContainer', ["$scope", "$http", "$mdToast", function (_, $http, $mdToast) {
  _.api = 'http://ayudh.org:3337';
  _.createdOne = localStorage.createdOne && parseInt(localStorage.createdOne) || 0;
  // _.api = 'http://localhost:3337'
  _.getSetsforTerm = function (term) {
    return $http.get(_.api + '/quizlet/search?query=' + term, { cache: true });
  };
  _.getSets = function (sets) {
    return $http.get(_.api + '/quizlet/sets?query=' + sets, { cache: true });
  };
  _.decks = {};
  // _.decks = JSON.parse(localStorage.decks || '{}')
  _.selected = JSON.parse(localStorage.selected || '{}');
  _.selectedOrder = "time";
  _.reverse = true;
  _.md = false;
  _.numSelected = function () {
    return lo.size(_.selected);
  };
  _.selectedArray = function () {
    return lo.values(_.selected);
  };
  _.selectTerm = function (term, setId) {
    var mouseDown = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;

    term.selected = !!mouseDown ? !!!term.selected : !!term.selected;
    if (term.selected) {
      _.selected[term.id] = lo.assign({}, term);
      _.selected[term.id].setId = setId;
      _.selected[term.id].time = new Date().getTime();
    } else {
      delete _.selected[term.id];
    }
    localStorage.selected = JSON.stringify(_.selected);
  };
  _.removeDeck = function (id) {
    return delete _.decks[id];
  };
  _.selectAll = function (id) {
    if (_.decks[id]) {
      // some unselected, then select all
      if (_.decks[id].terms.find(function (x) {
        return !x.selected;
      })) {
        _.decks[id].terms.forEach(function (term) {
          term.selected = true;
          _.selected[term.id] = lo.assign({}, term);
          _.selected[term.id].setId = id;
          _.selected[term.id].time = new Date().getTime();
        });
      } else {
        // unselect everything
        _.decks[id].terms.forEach(function (term) {
          term.selected = false;
          delete _.selected[term.id];
        });
      }
      localStorage.selected = JSON.stringify(_.selected);
    }
  };
  _.clearSelected = function () {
    _.selected = {};
    localStorage.selected = '{}';
  };
  _.swapSelected = function (id) {
    var _$selected$id = _.selected[id],
        term = _$selected$id.term,
        definition = _$selected$id.definition;

    _.selected[id].definition = term;
    _.selected[id].term = definition;
    localStorage.selected = JSON.stringify(_.selected);
  };
  _.removeSelected = function (id) {
    var _$selected$id2 = _.selected[id],
        setId = _$selected$id2.setId,
        rank = _$selected$id2.rank;

    if (_.decks[setId]) {
      _.decks[setId].terms[rank].selected = false;
    }
    delete _.selected[id];
    localStorage.selected = JSON.stringify(_.selected);
  };
  _.create = function (title) {
    _.url = null;
    _.creating = true;
    $http({
      method: 'POST',
      url: _.api + '/create-set',
      data: JSON.stringify({
        title: title,
        lang_terms: 'en',
        lang_definitions: 'en',
        data: lo.map(_.selected, function (v, k) {
          return lo.pick(v, ['term', 'definition', 'image']);
        })
      })
    }).then(function (res) {
      _.url = 'https://quizlet.com' + res.data.url;
      _.creating = false;
      if (res.data.error) {
        $mdToast.showSimple(res.data.error);
      } else {
        $mdToast.showSimple("Your deck is created");
        _.createdOne += 1;
        localStorage.createdOne = _.createdOne;
      }
    }).catch(function () {
      _.creating = false;
      $mdToast.showSimple("Unable to create deck");
    });
  };
  _.import = function (importUrl) {
    var x = importUrl && importUrl.match(/\d+/);
    x && x[0] && _.getSets(x[0]).then(function (res) {
      res.data.forEach(function (set) {
        set.terms.forEach(function (term) {
          term.selected = true;
          _.selected[term.id] = lo.assign({}, term);
          _.selected[term.id].setId = set.id;
          _.selected[term.id].time = new Date().getTime();
        });
      });
    });
    localStorage.selected = JSON.stringify(_.selected);
  };
  _.getTerms = function (replace) {
    _.decks = !!replace ? {} : _.decks || {};
    _.bloom = !!replace ? new BloomFilter(3e5, 3e-5) : _.bloom || new BloomFilter(3e5, 3e-5);
    _.search.split(',').forEach(function (term) {
      _.getSetsforTerm(term.trim()).then(function (data) {
        _.getSets(data.data.sets.map(function (a) {
          return a.id;
        }).join(',')).then(function (res) {
          res.data.forEach(function (set) {
            var terms = lo.filter(set.terms, function (card) {
              if (_.bloom.test(card.term + card.definition)) {
                return false;
              } else {
                _.bloom.add(card.term + card.definition);
                return true;
              }
            });
            terms.forEach(function (t, i) {
              return t.rank = i;
            });
            if (terms.length > 2) {
              _.decks[set.id] = lo.pick(set, ['url', 'title', 'modified_date', 'lang_terms', 'lang_definitions']);
              _.decks[set.id].terms = terms;
              _.decks[set.id].terms_length = terms.length;
            }
          });
          // localStorage.decks = JSON.stringify(_.decks)
        });
      });
    });
  };
}]);

//# sourceMappingURL=data:application/json;base64,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RUFBRSxLQUFGLENBQVEsSUFBUixDQUFhLEtBQUssSUFBTCxHQUFZLEtBQUssVUFBOUIsQ0FBSixFQUErQztBQUM3Qyx1QkFBTyxLQUFQO0FBQ0QsZUFGRCxNQUVPO0FBQ0wsa0JBQUUsS0FBRixDQUFRLEdBQVIsQ0FBWSxLQUFLLElBQUwsR0FBWSxLQUFLLFVBQTdCO0FBQ0EsdUJBQU8sSUFBUDtBQUNEO0FBQ0YsYUFQVyxDQUFaO0FBUUEsa0JBQU0sT0FBTixDQUFjLFVBQUMsQ0FBRCxFQUFHLENBQUg7QUFBQSxxQkFBUyxFQUFFLElBQUYsR0FBUyxDQUFsQjtBQUFBLGFBQWQ7QUFDQSxnQkFBSSxNQUFNLE1BQU4sR0FBZSxDQUFuQixFQUFxQjtBQUNuQixnQkFBRSxLQUFGLENBQVEsSUFBSSxFQUFaLElBQWtCLEdBQUcsSUFBSCxDQUFRLEdBQVIsRUFBYSxDQUFDLEtBQUQsRUFBUSxPQUFSLEVBQWlCLGVBQWpCLEVBQWtDLFlBQWxDLEVBQWdELGtCQUFoRCxDQUFiLENBQWxCO0FBQ0EsZ0JBQUUsS0FBRixDQUFRLElBQUksRUFBWixFQUFnQixLQUFoQixHQUF3QixLQUF4QjtBQUNBLGdCQUFFLEtBQUYsQ0FBUSxJQUFJLEVBQVosRUFBZ0IsWUFBaEIsR0FBK0IsTUFBTSxNQUFyQztBQUNEO0FBQ0YsV0FmRDtBQWdCQTtBQUNELFNBbkJIO0FBb0JDLE9BckJIO0FBc0JDLEtBdkJIO0FBd0JDLEdBM0JIO0FBNEJELENBckk0QixDQWpCbkIsQ0FBViIsImZpbGUiOiJhcHAucHJvZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIGJhYmVsXCI7XG5pZiAobG9jYXRpb24ucHJvdG9jb2wgIT0gJ2h0dHA6Jykge1xuICBsb2NhdGlvbi5wcm90b2NvbCA9ICdodHRwOic7XG59XG4vLyBpZiAoJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvcikge1xuLy8gICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3Rlcignc2VydmljZS13b3JrZXIuanMnKTtcbi8vIH1cbi8vIHJlbW92ZWQgc2VydmljZSB3b3JrZXJzIGFuZCBmZXRjaCBiZWNhdXNlIHF1aXpsZXQgZG9lcyBub3QgZG8gY29ycyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vYS8zNDk0MDA3NCBcbi8vIG5vLWNvcnMgbW9kZSB3b24ndCBzZW5kIGF1dGhvcml6YXRpb24gaGVhZGVyIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9SZXF1ZXN0L21vZGVcbnZhciBsbyA9IF87XG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ2RlY2tqYW0nLCBbJ25nTWF0ZXJpYWwnLCAnYW5ndWxhcnRpY3MnLCAnYW5ndWxhcnRpY3MuZ29vZ2xlLmFuYWx5dGljcyddKVxuLmNvbmZpZyhmdW5jdGlvbigkbWRUaGVtaW5nUHJvdmlkZXIpIHtcbiAgdmFyIGN1c3RvbUJsdWVNYXAgPSAkbWRUaGVtaW5nUHJvdmlkZXIuZXh0ZW5kUGFsZXR0ZSgnbGlnaHQtYmx1ZScsIHtcbiAgICAnY29udHJhc3REZWZhdWx0Q29sb3InOiAnbGlnaHQnLFxuICAgICdjb250cmFzdERhcmtDb2xvcnMnOiBbJzUwJ10sXG4gICAgJzUwJzogJ2ZmZmZmZidcbiAgfSlcbiAgJG1kVGhlbWluZ1Byb3ZpZGVyLmRlZmluZVBhbGV0dGUoJ2N1c3RvbUJsdWUnLCBjdXN0b21CbHVlTWFwKVxuICAkbWRUaGVtaW5nUHJvdmlkZXIudGhlbWUoJ2RlZmF1bHQnKVxuICAgIC5wcmltYXJ5UGFsZXR0ZSgnY3VzdG9tQmx1ZScsIHtcbiAgICAgICdkZWZhdWx0JzogJzUwMCcsXG4gICAgICAnaHVlLTEnOiAnNTAnXG4gICAgfSlcbiAgICAuYWNjZW50UGFsZXR0ZSgncGluaycpXG4gICRtZFRoZW1pbmdQcm92aWRlci50aGVtZSgnaW5wdXQnLCAnZGVmYXVsdCcpXG4gICAgLnByaW1hcnlQYWxldHRlKCdncmV5Jylcbn0pXG4uY29udHJvbGxlcignaG9tZUNvbnRhaW5lcicsIFtcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiJG1kVG9hc3RcIiAsKF8sICRodHRwLCAkbWRUb2FzdCk9PiB7XG4gIF8uYXBpID0gJ2h0dHA6Ly9heXVkaC5vcmc6MzMzNydcbiAgXy5jcmVhdGVkT25lID0gbG9jYWxTdG9yYWdlLmNyZWF0ZWRPbmUgJiYgcGFyc2VJbnQobG9jYWxTdG9yYWdlLmNyZWF0ZWRPbmUpIHx8IDBcbiAgLy8gXy5hcGkgPSAnaHR0cDovL2xvY2FsaG9zdDozMzM3J1xuICBfLmdldFNldHNmb3JUZXJtID0gKHRlcm0pPT4gJGh0dHAuZ2V0KGAke18uYXBpfS9xdWl6bGV0L3NlYXJjaD9xdWVyeT0ke3Rlcm19YCwgeyBjYWNoZTogdHJ1ZX0pXG4gIF8uZ2V0U2V0cyA9IChzZXRzKT0+ICRodHRwLmdldChgJHtfLmFwaX0vcXVpemxldC9zZXRzP3F1ZXJ5PSR7c2V0c31gLCB7IGNhY2hlOiB0cnVlfSlcbiAgXy5kZWNrcyA9IHt9XG4gIC8vIF8uZGVja3MgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5kZWNrcyB8fCAne30nKVxuICBfLnNlbGVjdGVkID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWQgfHwgJ3t9JylcbiAgXy5zZWxlY3RlZE9yZGVyID0gXCJ0aW1lXCJcbiAgXy5yZXZlcnNlID0gdHJ1ZVxuICBfLm1kID0gZmFsc2VcbiAgXy5udW1TZWxlY3RlZCA9ICgpPT4gbG8uc2l6ZShfLnNlbGVjdGVkKVxuICBfLnNlbGVjdGVkQXJyYXkgPSAoKT0+IGxvLnZhbHVlcyhfLnNlbGVjdGVkKVxuICBfLnNlbGVjdFRlcm0gPSAodGVybSwgc2V0SWQsIG1vdXNlRG93bj10cnVlKSA9PiB7XG4gICAgdGVybS5zZWxlY3RlZCA9ICghIW1vdXNlRG93bikgPyAhISF0ZXJtLnNlbGVjdGVkIDogISF0ZXJtLnNlbGVjdGVkXG4gICAgaWYgKHRlcm0uc2VsZWN0ZWQpIHtcbiAgICAgIF8uc2VsZWN0ZWRbdGVybS5pZF0gPSBsby5hc3NpZ24oe30sdGVybSlcbiAgICAgIF8uc2VsZWN0ZWRbdGVybS5pZF0uc2V0SWQgPSBzZXRJZFxuICAgICAgXy5zZWxlY3RlZFt0ZXJtLmlkXS50aW1lID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKVxuICAgIH0gZWxzZSB7XG4gICAgICBkZWxldGUgXy5zZWxlY3RlZFt0ZXJtLmlkXVxuICAgIH1cbiAgICBsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWQgPSBKU09OLnN0cmluZ2lmeShfLnNlbGVjdGVkKVxuICB9XG4gIF8ucmVtb3ZlRGVjayA9IGlkPT4gZGVsZXRlIF8uZGVja3NbaWRdXG4gIF8uc2VsZWN0QWxsID0gaWQ9PiB7XG4gICAgaWYgKF8uZGVja3NbaWRdKSB7XG4gICAgICAvLyBzb21lIHVuc2VsZWN0ZWQsIHRoZW4gc2VsZWN0IGFsbFxuICAgICAgaWYgKF8uZGVja3NbaWRdLnRlcm1zLmZpbmQoeD0+ICF4LnNlbGVjdGVkKSl7XG4gICAgICAgIF8uZGVja3NbaWRdLnRlcm1zLmZvckVhY2godGVybSA9PiB7XG4gICAgICAgICAgdGVybS5zZWxlY3RlZCA9IHRydWVcbiAgICAgICAgICBfLnNlbGVjdGVkW3Rlcm0uaWRdID0gbG8uYXNzaWduKHt9LHRlcm0pXG4gICAgICAgICAgXy5zZWxlY3RlZFt0ZXJtLmlkXS5zZXRJZCA9IGlkXG4gICAgICAgICAgXy5zZWxlY3RlZFt0ZXJtLmlkXS50aW1lID0gKG5ldyBEYXRlKCkpLmdldFRpbWUoKVxuICAgICAgICB9KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gdW5zZWxlY3QgZXZlcnl0aGluZ1xuICAgICAgICBfLmRlY2tzW2lkXS50ZXJtcy5mb3JFYWNoKHRlcm0gPT4ge1xuICAgICAgICAgIHRlcm0uc2VsZWN0ZWQgPSBmYWxzZVxuICAgICAgICAgIGRlbGV0ZSBfLnNlbGVjdGVkW3Rlcm0uaWRdXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICBsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWQgPSBKU09OLnN0cmluZ2lmeShfLnNlbGVjdGVkKVxuICAgIH1cbiAgfVxuICBfLmNsZWFyU2VsZWN0ZWQgPSAoKT0+IHtcbiAgICBfLnNlbGVjdGVkID0ge31cbiAgICBsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWQgPSAne30nXG4gIH1cbiAgXy5zd2FwU2VsZWN0ZWQgPSBpZD0+IHtcbiAgICB2YXIge3Rlcm0sIGRlZmluaXRpb259ID0gXy5zZWxlY3RlZFtpZF1cbiAgICBfLnNlbGVjdGVkW2lkXS5kZWZpbml0aW9uID0gdGVybVxuICAgIF8uc2VsZWN0ZWRbaWRdLnRlcm0gPSBkZWZpbml0aW9uXG4gICAgbG9jYWxTdG9yYWdlLnNlbGVjdGVkID0gSlNPTi5zdHJpbmdpZnkoXy5zZWxlY3RlZClcbiAgfVxuICBfLnJlbW92ZVNlbGVjdGVkID0gaWQ9PiB7XG4gICAgdmFyIHtzZXRJZCwgcmFua30gPSBfLnNlbGVjdGVkW2lkXVxuICAgIGlmKF8uZGVja3Nbc2V0SWRdKSB7XG4gICAgICBfLmRlY2tzW3NldElkXS50ZXJtc1tyYW5rXS5zZWxlY3RlZCA9IGZhbHNlXG4gICAgfVxuICAgIGRlbGV0ZSBfLnNlbGVjdGVkW2lkXVxuICAgIGxvY2FsU3RvcmFnZS5zZWxlY3RlZCA9IEpTT04uc3RyaW5naWZ5KF8uc2VsZWN0ZWQpXG4gIH1cbiAgXy5jcmVhdGUgPSAodGl0bGUpPT4ge1xuICAgIF8udXJsID0gbnVsbFxuICAgIF8uY3JlYXRpbmcgPSB0cnVlXG4gICAgJGh0dHAoe1xuICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICB1cmw6IGAke18uYXBpfS9jcmVhdGUtc2V0YCxcbiAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdGl0bGU6IHRpdGxlLFxuICAgICAgICBsYW5nX3Rlcm1zOiAnZW4nLFxuICAgICAgICBsYW5nX2RlZmluaXRpb25zOiAnZW4nLFxuICAgICAgICBkYXRhOiBsby5tYXAoXy5zZWxlY3RlZCwgKHYsayk9PiBsby5waWNrKHYsIFsndGVybScsICdkZWZpbml0aW9uJywgJ2ltYWdlJ10pKVxuICAgICAgfSlcbiAgICB9KS50aGVuKHJlcz0+e1xuICAgICAgXy51cmwgPSBgaHR0cHM6Ly9xdWl6bGV0LmNvbSR7cmVzLmRhdGEudXJsfWBcbiAgICAgIF8uY3JlYXRpbmcgPSBmYWxzZVxuICAgICAgaWYgKHJlcy5kYXRhLmVycm9yKSB7XG4gICAgICAgICRtZFRvYXN0LnNob3dTaW1wbGUocmVzLmRhdGEuZXJyb3IpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkbWRUb2FzdC5zaG93U2ltcGxlKFwiWW91ciBkZWNrIGlzIGNyZWF0ZWRcIilcbiAgICAgICAgXy5jcmVhdGVkT25lICs9IDFcbiAgICAgICAgbG9jYWxTdG9yYWdlLmNyZWF0ZWRPbmUgPSBfLmNyZWF0ZWRPbmVcbiAgICAgIH1cbiAgICB9KS5jYXRjaCgoKT0+e1xuICAgICAgXy5jcmVhdGluZz1mYWxzZVxuICAgICAgJG1kVG9hc3Quc2hvd1NpbXBsZShcIlVuYWJsZSB0byBjcmVhdGUgZGVja1wiKVxuICAgIH0pXG4gIH1cbiAgXy5pbXBvcnQgPSAoaW1wb3J0VXJsKSA9PiB7XG4gICAgdmFyIHggPSBpbXBvcnRVcmwgJiYgaW1wb3J0VXJsLm1hdGNoKC9cXGQrLylcbiAgICB4ICYmIHhbMF0gJiYgXy5nZXRTZXRzKHhbMF0pLnRoZW4ocmVzPT57XG4gICAgICByZXMuZGF0YS5mb3JFYWNoKHNldD0+IHtcbiAgICAgICAgc2V0LnRlcm1zLmZvckVhY2godGVybSA9PiB7XG4gICAgICAgICAgdGVybS5zZWxlY3RlZCA9IHRydWVcbiAgICAgICAgICBfLnNlbGVjdGVkW3Rlcm0uaWRdID0gbG8uYXNzaWduKHt9LHRlcm0pXG4gICAgICAgICAgXy5zZWxlY3RlZFt0ZXJtLmlkXS5zZXRJZCA9IHNldC5pZFxuICAgICAgICAgIF8uc2VsZWN0ZWRbdGVybS5pZF0udGltZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKClcbiAgICAgICAgfSlcbiAgICAgIH0pXG4gICAgfSlcbiAgICBsb2NhbFN0b3JhZ2Uuc2VsZWN0ZWQgPSBKU09OLnN0cmluZ2lmeShfLnNlbGVjdGVkKVxuICB9XG4gIF8uZ2V0VGVybXMgPSAocmVwbGFjZSk9PiB7XG4gICAgXy5kZWNrcyA9ICEhcmVwbGFjZSA/IHt9IDogKF8uZGVja3MgfHwge30pXG4gICAgXy5ibG9vbSA9ICEhcmVwbGFjZSA/IG5ldyBCbG9vbUZpbHRlcigzZTUsIDNlLTUpIDogKF8uYmxvb20gfHwgbmV3IEJsb29tRmlsdGVyKDNlNSwgM2UtNSkpXG4gICAgXy5zZWFyY2guc3BsaXQoJywnKS5mb3JFYWNoKHRlcm09PiB7XG4gICAgICBfLmdldFNldHNmb3JUZXJtKHRlcm0udHJpbSgpKS50aGVuKGRhdGE9PiB7XG4gICAgICAgIF8uZ2V0U2V0cyhkYXRhLmRhdGEuc2V0cy5tYXAoYT0+YS5pZCkuam9pbignLCcpKVxuICAgICAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICByZXMuZGF0YS5mb3JFYWNoKHNldD0+IHtcbiAgICAgICAgICAgICAgdmFyIHRlcm1zID0gbG8uZmlsdGVyKHNldC50ZXJtcywgY2FyZD0+IHtcbiAgICAgICAgICAgICAgICBpZiAoXy5ibG9vbS50ZXN0KGNhcmQudGVybSArIGNhcmQuZGVmaW5pdGlvbikpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBfLmJsb29tLmFkZChjYXJkLnRlcm0gKyBjYXJkLmRlZmluaXRpb24pXG4gICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgdGVybXMuZm9yRWFjaCgodCxpKSA9PiB0LnJhbmsgPSBpKVxuICAgICAgICAgICAgICBpZiAodGVybXMubGVuZ3RoID4gMil7XG4gICAgICAgICAgICAgICAgXy5kZWNrc1tzZXQuaWRdID0gbG8ucGljayhzZXQsIFsndXJsJywgJ3RpdGxlJywgJ21vZGlmaWVkX2RhdGUnLCAnbGFuZ190ZXJtcycsICdsYW5nX2RlZmluaXRpb25zJ10pXG4gICAgICAgICAgICAgICAgXy5kZWNrc1tzZXQuaWRdLnRlcm1zID0gdGVybXNcbiAgICAgICAgICAgICAgICBfLmRlY2tzW3NldC5pZF0udGVybXNfbGVuZ3RoID0gdGVybXMubGVuZ3RoXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvLyBsb2NhbFN0b3JhZ2UuZGVja3MgPSBKU09OLnN0cmluZ2lmeShfLmRlY2tzKVxuICAgICAgICAgIH0pXG4gICAgICAgIH0pXG4gICAgICB9KVxuICAgIH1cbn1dKVxuIl19